<!DOCTYPE html>
<html>
<head>
    <title>Real Admin API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Real Admin API Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        async function testAPI() {
            results.innerHTML += '<h2>Testing Real Admin API...</h2>';
            
            // Set a mock session token (admin panel would set this)
            localStorage.setItem('session_token', 'admin-test-token');
            
            try {
                // Test GET settings
                results.innerHTML += '<h3>üîç GET /api/admin?action=settings</h3>';
                const getResponse = await fetch('/api/admin?action=settings');
                const getData = await getResponse.json();
                
                if (getResponse.ok) {
                    results.innerHTML += '<div class="success">‚úÖ GET Success:</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(getData, null, 2) + '</pre>';
                } else {
                    results.innerHTML += '<div class="error">‚ùå GET Error:</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(getData, null, 2) + '</pre>';
                }
                
                // Test POST settings - update hero button URL
                results.innerHTML += '<h3>üì§ POST /api/admin?action=update-settings</h3>';
                const testUrl = 'https://test-' + Date.now() + '.example.com/rekber';
                const postResponse = await fetch('/api/admin?action=update-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer admin-test-token'
                    },
                    body: JSON.stringify({
                        hero_button_url: testUrl
                    })
                });
                const postData = await postResponse.json();
                
                if (postResponse.ok) {
                    results.innerHTML += '<div class="success">‚úÖ POST Success:</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(postData, null, 2) + '</pre>';
                } else {
                    results.innerHTML += '<div class="error">‚ùå POST Error:</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(postData, null, 2) + '</pre>';
                }
                
                // Test GET again to verify the update persisted
                results.innerHTML += '<h3>üîÑ GET /api/admin?action=settings (after update)</h3>';
                const getResponse2 = await fetch('/api/admin?action=settings');
                const getData2 = await getResponse2.json();
                
                if (getResponse2.ok) {
                    results.innerHTML += '<div class="success">‚úÖ GET Success (verification):</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(getData2, null, 2) + '</pre>';
                    
                    // Check if our update persisted
                    if (getData2.data && getData2.data.hero_button_url === testUrl) {
                        results.innerHTML += '<div class="success">üéâ UPDATE VERIFIED: Data persisted correctly!</div>';
                    } else {
                        results.innerHTML += '<div class="error">‚ö†Ô∏è UPDATE NOT PERSISTED: Data did not save to database.</div>';
                    }
                } else {
                    results.innerHTML += '<div class="error">‚ùå GET Error (verification):</div>';
                    results.innerHTML += '<pre>' + JSON.stringify(getData2, null, 2) + '</pre>';
                }
                
            } catch (error) {
                results.innerHTML += '<div class="error">üí• JavaScript Error: ' + error.message + '</div>';
                console.error('Test error:', error);
            }
        }
        
        testAPI();
    </script>
</body>
</html>
